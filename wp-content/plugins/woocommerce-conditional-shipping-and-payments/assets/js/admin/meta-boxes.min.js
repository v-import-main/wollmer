jQuery(function(_){_.fn.csp_scripts=function(){_(this).sw_select2(),_(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var c=_("#restrictions_data"),s=c.find(".bulk_toggle_wrapper"),r=c.find(".wc-metaboxes"),a=c.find(".hr-section--conditions-and.temp-placeholder"),d=r.find(".woocommerce_restriction").length,o=!1;function l(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}""===wc_restrictions_admin_params.post_id?(c.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),_(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),_(".column-wc_actions a").on("mousedown",function(){_(this).triggerHandler("mouseleave")}),c.on("click",".wc-metabox > h3",function(){_(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),_(this).next(".wc-metabox-content").stop().slideToggle(300)}),c.sw_select2(),_(".wc-metabox",c).each(function(){var e=_(this),t=e.find(".wc-metabox-content");e.hasClass("closed")&&t.hide()})):c.sw_select2(),c.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var t=_(this),n=t.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),e=t.closest(".woocommerce_restriction"),o=e.data("restriction_id"),i=e.data("index");if(-1<e[0].className.indexOf("woocommerce_restriction--added"))return l(t,n),!1;t.addClass("woocommerce-input-toggle--loading");e={action:"woocommerce_toggle_restriction",value:n.val(),post_id:wc_restrictions_admin_params.post_id,hash:r.attr("data-hash"),index:i,restriction_id:o,security:wc_restrictions_admin_params.toggle_restriction_nonce};return _.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:e,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){0<e.errors.length?window.alert(e.errors.join("\n\n")):(l(t,n),r.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(e){var t=_(this).closest(".wc-metabox");t.find("*").off(),t.remove(),o=!0,n(),e.preventDefault()}),c.on("keyup","input.short_description",function(){_(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(_(this).val())}).on("click",".expand_all",function(){return r.find(".wc-metabox").each(function(){var e=_(this);e.find(".wc-metabox-content").show(),e.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return r.find(".wc-metabox").each(function(){var e=_(this);e.find(".wc-metabox-content").hide(),e.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries, select.csp_billing_countries",function(){var n,e=_(this),t=e.hasClass("csp_shipping_countries")?"shipping":"billing",o=(o=(o=e).selectSW("data"),n=[],_.each(o,function(e,t){n.push({key:t.id,value:t.text})}),n),e=e.closest(".condition_content, .woocommerce_restriction_form"),e="shipping"==t?e.find("select.csp_shipping_states"):e.find("select.csp_billing_states"),i=e.find(":selected"),c=[],s="shipping"==t?wc_restrictions_admin_params.shipping_states_data:wc_restrictions_admin_params.billing_states_data,r=[],a=wc_restrictions_admin_params.continents_data,d=wc_restrictions_admin_params.countries_data,l=[];i.each(function(){c.push(_(this).val())}),_.each(o,function(e,t){var n;t.key.includes("continent:")?(n=t.key.replace("continent:",""),n=a[n].countries,_.each(n,function(e,t){u(l,t)||l.push({key:t,value:d[t]})})):(n="")===(n=t.key.includes("country:")?t.key.replace("country:",""):t.key)||u(l,n)||l.push({key:n,value:t.value})}),l.sort(m),_.each(l,function(e,t){var n=[],o=t.key,i=t.value,t=s[o]||!1;if(!t||0===t.length)return!0;_.each(t,function(e,t){e=o+":"+e;n.push({id:e,text:i+" â€” "+t,selected:-1!==_.inArray(e,c)})}),r.push({text:i,children:n})}),e.children().remove(),r.sort(m),e.selectSW({data:r})}).on("click",".wccsp_select_all",function(){var e=_(this).closest(".select-field");return e.find("select option").prop("selected","selected"),e.find("select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){var e=_(this).closest(".select-field");return e.find("select option").prop("selected",!1),e.find("select").trigger("change"),!1}).on("click","button.add_restriction",function(){var n=_("select.restriction_type",c),e=n.val(),t=r.find(".woocommerce_restriction_"+e),o=r.find(".woocommerce_restriction");if(""===e)return wc_restrictions_admin_params.post_id&&n.trigger("focus"),!1;c.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var i={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:d,restriction_id:e,applied_count:t.length,count:o.length,security:wc_restrictions_admin_params.add_restriction_nonce};return d++,setTimeout(function(){_.post(wc_restrictions_admin_params.wc_ajax_url,i,function(e){var t;0<e.errors.length?window.alert(e.errors.join("\n\n")):(c.trigger("woocommerce_before_restriction_add",e),r.append(e.markup),(t=r.find(".woocommerce_restriction").last()).csp_scripts(),t.data("conditions_count",0),s.removeClass("disabled")),wc_restrictions_admin_params.post_id&&n.val(""),c.unblock(),c.trigger("woocommerce_restriction_added",e)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){c.removeClass("restrictions_data--empty")}).on("change","input.show_excluded_in_checkout",function(){var e=_(this),t=e.is(":checked"),e=e.closest(".woocommerce_restriction_data").find(".show-excluded-checked");t?e.show():e.hide()});var e,p={},i={};function u(e,n){var o=!1;return _.each(e,function(e,t){if(t.key===n)return!(o=!0)}),o}function m(e,t){var n=0;return e.hasOwnProperty("text")&&t.hasOwnProperty("text")&&(e.text>t.text?n=1:t.text>e.text&&(n=-1)),e.hasOwnProperty("value")&&t.hasOwnProperty("value")&&(e.value>t.value?n=1:t.value>e.value&&(n=-1)),n}function f(e,t){var n=!1;return"object"==typeof i[e]&&"function"==typeof i[e][t]?n=i[e][t]:(n=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===i[e]&&(i[e]={}),i[e][t]=n),n}function n(){var n=!1;r.find(".woocommerce_restriction").each(function(e,t){_(".position",t).val(e),_(".restriction_title_index",t).html(e+1),n=!0}),n?(s.removeClass("disabled"),c.removeClass("restrictions_data--empty")):(s.addClass("disabled"),c.addClass("restrictions_data--empty")),o&&c.addClass("restrictions_data--removed")}r.find(".woocommerce_restriction").each(function(){var e=_(this).find(".restriction_conditions .condition_row").length;_(this).data("conditions_count",e)}),c.on("mousedown",".condition_remove .trash",function(){_(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(e){e.preventDefault();e=_(this).closest(".condition_row");return e.next(".hr-section--conditions-and").remove(),e.remove(),!0}).on("change",".condition_modifier select",function(){var e,t,n,i,c,o=_(this),s=o.closest(".condition_row_inner").find(".condition_value"),r=o.data("zero_config_mods"),a=o.hasClass("has_conditional_values");r&&(e=o.val(),t=s.filter(".condition--disabled"),n=s.not(".condition--disabled"),-1<r.indexOf(e)?(t.show(),n.hide()):(t.hide(),n.show())),a&&(i=o.val(),c=o.attr("data-value_input_name"),_.each(s,function(e,t){var t=_(t),n=t.attr("data-modifiers").split(","),n=_.inArray(i,n),o=t.find(".csp_conditional_values_input");t.hide(),o.attr("name",""),-1!==n&&(o.attr("name",c),t.show())}))}).on("change",".condition_add select.condition_type",function(){var e=_(this),t=e.val();if("add_condition"===t)return!1;var n=e.closest(".woocommerce_restriction"),o=n.data("restriction_id"),i=parseInt(n.data("index")),c=parseInt(n.data("conditions_count")),s=function(e){var t=!1;"function"==typeof p[e]?t=p[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),p[e]=t);return t}(o),r=n.find(".restriction_conditions_list"),o=f(o,t);if(!s||!o)return!1;s=s({condition_index:c,condition_content:o({restriction_index:i,condition_index:c})}),n.data("conditions_count",c+1),r.append(s),o=n.find(".restriction_conditions_list .condition_row").last();return a.clone().removeClass("temp-placeholder").appendTo(r),o.find('.condition_type option[value="'+t+'"]').prop("selected","selected"),o.csp_scripts(),e.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var e=_(this),t=e.val(),n=e.closest(".woocommerce_restriction"),o=n.data("restriction_id"),n=parseInt(n.data("index")),e=e.closest(".condition_row"),i=parseInt(e.data("condition_index")),o=f(o,t);if(!o)return!1;t=o({restriction_index:n,condition_index:i}),e.find(".condition_content").html(t).addClass("added"),o=e.find(".added");return o.csp_scripts(),o.removeClass("added"),!1}),(e=r.find(".woocommerce_restriction").get()).sort(function(e,t){e=parseInt(_(e).attr("data-index")),t=parseInt(_(t).attr("data-index"));return e<t?-1:t<e?1:0}),_(e).each(function(e,t){r.append(t)}),n(),r.sortable({items:".woocommerce_restriction",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),n()}})});