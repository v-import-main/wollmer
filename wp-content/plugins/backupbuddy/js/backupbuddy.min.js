var pb_backupbuddy_selectdestination;!function(e,t){var a;"onprogress"in e.ajaxSettings.xhr()&&(a=e.ajaxSettings.xhr,e.ajaxSettings.xhr=function(){var e=a.apply(this,arguments);return e instanceof t.XMLHttpRequest&&e.addEventListener("progress",this.progress,!1),e.upload&&e.upload.addEventListener("progress",this.progress,!1),e})}(jQuery,window),function(s,o){"use strict";var u="stickyTableHeaders",a=0,d={fixedOffset:0,leftOffset:0,marginTop:0,objDocument:document,objHead:"head",objWindow:o,scrollableArea:o,cacheHeaderHeight:!1,zIndex:3};s.fn[u]=function(t){return this.each(function(){var e=s.data(this,"plugin_"+u);e?"string"==typeof t?e[t].apply(e):e.updateOptions(t):"destroy"!==t&&s.data(this,"plugin_"+u,new function(e,t){var r=this;r.$el=s(e),r.el=e,r.id=a++,r.$el.bind("destroyed",s.proxy(r.teardown,r)),r.$clonedHeader=null,r.$originalHeader=null,r.cachedHeaderHeight=null,r.isSticky=!1,r.hasBeenSticky=!1,r.leftOffset=null,r.topOffset=null,r.init=function(){r.setOptions(t),r.$el.each(function(){var e=s(this);e.css("padding",0),r.$originalHeader=s("thead:first",this),r.$clonedHeader=r.$originalHeader.clone(),e.trigger("clonedHeader."+u,[r.$clonedHeader]),r.$clonedHeader.addClass("tableFloatingHeader"),r.$clonedHeader.css({display:"none",opacity:0}),r.$originalHeader.addClass("tableFloatingHeaderOriginal"),r.$originalHeader.after(r.$clonedHeader),r.$printStyle=s('<style type="text/css" media="print">.tableFloatingHeader{display:none !important;}.tableFloatingHeaderOriginal{position:static !important;}</style>'),r.$head.append(r.$printStyle)}),r.$clonedHeader.find("input, select").attr("disabled",!0),r.updateWidth(),r.toggleHeaders(),r.bind()},r.destroy=function(){r.$el.unbind("destroyed",r.teardown),r.teardown()},r.teardown=function(){r.isSticky&&r.$originalHeader.css("position","static"),s.removeData(r.el,"plugin_"+u),r.unbind(),r.$clonedHeader.remove(),r.$originalHeader.removeClass("tableFloatingHeaderOriginal"),r.$originalHeader.css("visibility","visible"),r.$printStyle.remove(),r.el=null,r.$el=null},r.bind=function(){r.$scrollableArea.on("scroll."+u,r.toggleHeaders),r.isWindowScrolling||(r.$window.on("scroll."+u+r.id,r.setPositionValues),r.$window.on("resize."+u+r.id,r.toggleHeaders)),r.$scrollableArea.on("resize."+u,r.toggleHeaders),r.$scrollableArea.on("resize."+u,r.updateWidth)},r.unbind=function(){r.$scrollableArea.off("."+u,r.toggleHeaders),r.isWindowScrolling||(r.$window.off("."+u+r.id,r.setPositionValues),r.$window.off("."+u+r.id,r.toggleHeaders)),r.$scrollableArea.off("."+u,r.updateWidth)},r.debounce=function(a,d){var n=null;return function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){a.apply(e,t)},d)}},r.toggleHeaders=r.debounce(function(){r.$el&&r.$el.each(function(){var e,t=s(this),a=r.isWindowScrolling?isNaN(r.options.fixedOffset)?r.options.fixedOffset.outerHeight():r.options.fixedOffset:r.$scrollableArea.offset().top+(isNaN(r.options.fixedOffset)?0:r.options.fixedOffset),d=t.offset(),n=r.$scrollableArea.scrollTop()+a,i=r.$scrollableArea.scrollLeft(),o=r.isWindowScrolling?n>d.top:a>d.top;o&&(e=r.options.cacheHeaderHeight?r.cachedHeaderHeight:r.$clonedHeader.height(),e=(r.isWindowScrolling?n:0)<d.top+t.height()-e-(r.isWindowScrolling?0:a)),o&&e?(i=d.left-i+r.options.leftOffset,r.$originalHeader.css({position:"fixed","margin-top":r.options.marginTop,top:0,left:i,"z-index":r.options.zIndex}),r.leftOffset=i,r.topOffset=a,r.$clonedHeader.css("display",""),r.isSticky||(r.isSticky=!0,r.updateWidth(),t.trigger("enabledStickiness."+u)),r.setPositionValues()):r.isSticky&&(r.$originalHeader.css("position","static"),r.$clonedHeader.css("display","none"),r.isSticky=!1,r.resetWidth(s("td,th",r.$clonedHeader),s("td,th",r.$originalHeader)),t.trigger("disabledStickiness."+u))})},0),r.setPositionValues=r.debounce(function(){var e=r.$window.scrollTop(),t=r.$window.scrollLeft();!r.isSticky||e<0||e+r.$window.height()>r.$document.height()||t<0||t+r.$window.width()>r.$document.width()||r.$originalHeader.css({top:r.topOffset-(r.isWindowScrolling?0:e),left:r.leftOffset-(r.isWindowScrolling?0:t)})},0),r.updateWidth=r.debounce(function(){var e;r.isSticky&&(r.$originalHeaderCells||(r.$originalHeaderCells=s("th,td",r.$originalHeader)),r.$clonedHeaderCells||(r.$clonedHeaderCells=s("th,td",r.$clonedHeader)),e=r.getWidth(r.$clonedHeaderCells),r.setWidth(e,r.$clonedHeaderCells,r.$originalHeaderCells),r.$originalHeader.css("width",r.$clonedHeader.width()),r.options.cacheHeaderHeight&&(r.cachedHeaderHeight=r.$clonedHeader.height()))},0),r.getWidth=function(e){var i=[];return e.each(function(e){var t,a,d,n=s(this);n="border-box"===n.css("box-sizing")?(d=n[0].getBoundingClientRect()).width||d.right-d.left:"collapse"===s("th",r.$originalHeader).css("border-collapse")?o.getComputedStyle?parseFloat(o.getComputedStyle(this,null).width):(t=parseFloat(n.css("padding-left")),a=parseFloat(n.css("padding-right")),d=parseFloat(n.css("border-width")),n.outerWidth()-t-a-d):n.width(),i[e]=n}),i},r.setWidth=function(a,e,d){e.each(function(e){var t=a[e];d.eq(e).css({"min-width":t,"max-width":t})})},r.resetWidth=function(e,a){e.each(function(e){var t=s(this);a.eq(e).css({"min-width":t.css("min-width"),"max-width":t.css("max-width")})})},r.setOptions=function(e){r.options=s.extend({},d,e),r.$window=s(r.options.objWindow),r.$head=s(r.options.objHead),r.$document=s(r.options.objDocument),r.$scrollableArea=s(r.options.scrollableArea),r.isWindowScrolling=r.$scrollableArea[0]===r.$window[0]},r.updateOptions=function(e){r.setOptions(e),r.unbind(),r.bind(),r.updateWidth(),r.toggleHeaders()},r.init()}(this,t))})}}(jQuery,window),(BackupBuddy=window.BackupBuddy||{}).Backups=function(o){"use strict";var e=function(){o(".pb_backupbuddy_hoveraction_send").on("click",function(e){return e.preventDefault(),tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data="+o(this).attr("rel")+"&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null),!1}),o("a.remote-send").off("click").on("click",function(e){e.preventDefault();e=o(this).attr("data-backup-zip");return tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data="+e+"&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null),!1})},t=function(){o(".backup-actions").off("click").on("click",function(e){e.preventDefault(),o(".backup-actions-menu.open").removeClass("open"),o(".backup-actions.active").not(o(this)).removeClass("active"),o(this).hasClass("active")?(o(this).removeClass("active"),o(this).blur()):(o(this).addClass("active"),o(this).next(".backup-actions-menu").addClass("open"))}),o(document).on("mouseup",function(e){return!!o(e.target).hasClass("backup-actions")||(o(".backup-actions-menu").removeClass("open"),o(".backup-actions.active").removeClass("active"),void o(".backup-actions").blur())})},a=function(){o(".pb_backupbuddy_hoveraction_hash").on("click",function(e){return e.preventDefault(),tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.hash")+"&callback_data="+o(this).attr("rel")+"&TB_iframe=1&width=640&height=455",null),!1})},d=function(){o(".pb_backupbuddy_hoveraction_note").on("click",function(e){e.preventDefault();e=o(this).parents("td").find(".pb_backupbuddy_notetext").text();return""==e&&(e="My first backup"),BackupBuddy.Modal.open({mode:"prompt",title:"Backup Note",content:BackupBuddy.Vars.get("strings.note_instructions"),prompt_default:e,prompt:function(e){if(null==e||""==e)return!1;o(".pb_backupbuddy_backuplist_loading").show(),o.post(BackupBuddy.Vars.get("ajax.set_backup_note"),{backup_file:o(this).attr("rel"),note:e},function(e){e=o.trim(e),o(".pb_backupbuddy_backuplist_loading").hide(),"1"!=e&&BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.error")+": "+e}),location.reload(!0)})}}),!1})},n=function(){o(".profile_item_cancel_add_select").off("click").on("click",function(e){e.preventDefault(),o("#pb_backupbuddy_profileadd").hide(),o("#pb_backupbuddy_profileadd_plusbutton").show()})},r=function(){o('a[href$="#backup-details"]').off("click").on("click",function(e){e.preventDefault();var t=o("<span />").addClass("spinner").css("float","none").css("visibility","visible").css("margin-top","-1px"),a=o("<div />").addClass("backupbuddy-backup-details loading").append(t).append("Loading..."),e=o(this).attr("data-backup-zip"),t=o(this).attr("data-destination-id");BackupBuddy.Modal.open({title:"Backup Details",content:a}),o.ajax({url:BackupBuddy.Vars.get("ajax.backup_info"),data:{backup:e,destination:t,return:"html"},success:function(e){a.removeClass("loading"),e.success?a.html(e.html):(e=void 0===e.error?"Could not retrieve backup detail.":e.error,a.addClass("failed").html(e))}})})},i=function(){var e=o(".backupbuddy-tabs .restore-backup");if(e.length&&!o("#backupbuddy-data-browser").length&&!o("#backupbuddy-restore-status").hasClass("open")){var t=BackupBuddy.Vars.get("destination_ids");if(t.length&&!e.data("remote-loaded")){e.data("remote-loaded",!0);for(var n=[],a=0;a<t.length;a++)n[a]=!0;var i=[];o(".restore-backups-table tbody tr:not(.hidden)").each(function(){i[i.length]=o(this).attr("data-id")}),s(n);for(var d=0;d<t.length;d++)o.ajax({url:BackupBuddy.Vars.get("ajax.remote_backups"),data:{mode:"restore",destination_id:t[d],index:d},success:function(e){if(e.success&&e.backups.length){for(var t,a=!!o(".restore-backups-table table").length,d=0;d<e.backups.length;d++)!1!==a||void 0===e.backups[d].restore?o(e.backups[d].restore).find("tbody tr").each(function(){var e,t=o(this),a=t.data("id");0<=o.inArray(a,i)?t.addClass("hidden"):(i[i.length]=a,e=parseInt(t.attr("data-timestamp")),(a=o(".restore-backups-table tbody tr").filter(function(){return parseInt(o(this).attr("data-timestamp"))<=e}).first()).length?a.before(t):o(".restore-backups-table tbody").append(t))}):((t=o(".restore-backups-table")).length||(t=o("<div />").addClass("restore-backups-table"),o("#backupbuddy-restore-status").length?o("#backupbuddy-restore-status").after(t):o("#restore-backup").prepend(t)),o("#restore-backup .no-backups-created").remove(),t.html(e.backups[d].restore),a=!0);r(),BackupBuddy.Restore.bind_restore_buttons()}o("#restore-backup th.stash-traditional-backup-files").length&&o("#restore-backup th.stash-traditional-backup-files:first").html(o("#restore-backup th.stash-traditional-backup-files:first").html().replace(BackupBuddy.Vars.get("strings.stash_table_header"),BackupBuddy.Vars.get("strings.backups_table_header"))),n[e.index]=!1,s(n),c()}})}}},s=function(e){for(var t=!1,a=o(".backupbuddy-tabs .restore-backup"),d=0;d<e.length;d++)if(e[d]){t=!0;break}t?a.length&&a.addClass("processing"):a.removeClass("processing")},u=function(){var t,a=o(".backupbuddy-generate-dat");!a.length||(t=a.data("zip"))&&o.ajax({url:BackupBuddy.Vars.get("ajax.create-dat"),data:{zip_file:t},success:function(e){e.success?(e=BackupBuddy.Vars.get("page_url"),e+="&dat_viewer="+encodeURI(t),e+="&value="+encodeURI(t),window.location.href=e):(a.hide(),o(".legacy-file-restore-wrapper").show(),backupbuddy_legacy_file_browser())}})},c=function(){for(var e=["#backups-main table.minimal",".restore-backups-table",".bb-iframe-divpadding-noscroll table.minimal"],t=0;t<e.length;t++){o(e[t]+" .separator").removeClass("separator"),o(e[t]+" .begin-month").removeClass("begin-month");var a="",d=0;o(e[t]+" tbody tr").each(function(e){var t=o(this).attr("class").split(" ").filter(function(e){return-1<e.indexOf("month-")});t[0]!==a?(a=t[0],(d=0)!==e&&o(this).addClass("begin-month")):d++,5===d&&(d=0,o(this).addClass("separator"))})}};return pb_backupbuddy_selectdestination=function(e,t,a,d,n){if(""!=a&&"delayed_send"!=a){if("importbuddy.php"===a){var i=o('<div id="pb_backupbuddy_ib_sent" class="pb_backupbuddy_alert updated fade">'+BackupBuddy.Vars.get("strings.sending_importbuddy")+"</div>");return o("h1:first").after(i),o.ajax({url:BackupBuddy.Vars.get("ajax.send_importbuddy"),data:{destination_id:e,destination_title:t,callback_data:a},success:function(e){(i=o("#pb_backupbuddy_ib_sent")).html(e.notice),e.success||i.removeClass("updated").addClass("error")}}),!1}o.post(BackupBuddy.Vars.get("ajax.remote_send"),{destination_id:e,destination_title:t,file:a,trigger:"manual",delete_after:d},function(e){var t;"1"!=(e=o.trim(e)).charAt(0)?BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.remote_send_error")+":\n\n"+e}):(t=" "+BackupBuddy.Vars.get("strings.local_delete_upon_success"),d||(t=""),BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.remote_send_confirmed")+t+"\n\n"+e.slice(1)}),o.post(BackupBuddy.Vars.get("ajax_base")))})}else"delayed_send"==a?(o("#pb_backupbuddy_backup_remotedestination").val(e),o("#pb_backupbuddy_backup_deleteafter").val(d),o("#pb_backupbuddy_backup_remotetitle").html('Destination: "'+t+'".')):window.location.href=BackupBuddy.Vars.get("admin_url")+"?page=pb_backupbuddy_backup&custom=remoteclient&destination_id="+e},{init:function(){e(),a(),d(),n(),r(),t(),i(),u(),c()},cleanup:function(e,t){o.ajax({url:BackupBuddy.Vars.get("ajax.cleanup"),data:{rel:e},success:function(e){e.success?o('div[rel="'+t+'"]').fadeOut("fast",function(){o(this).remove()}):o('div[rel="'+t+'"] .button-actions').addClass("error").html(e.error)}})}}}(jQuery),jQuery(window).on("load",BackupBuddy.Backups.init);var BackupBuddy=window.BackupBuddy||{},MutationObserver=window.MutationObserver||window.WebKitMutationObserver;BackupBuddy.Core=function(r){"use strict";function a(){r(".backupbuddy-admin-notices").is(":empty")&&(r(".backupbuddy-admin-notices").remove(),r(".backupbuddy-admin-notices-toggle").remove())}function t(){r(".backupbuddy-internal-notices").is(":empty")&&r(".backupbuddy-internal-notices").remove()}var e=function(){var e=new MutationObserver(d),t=r(".backupbuddy-admin-page #wpcontent").first();t.length&&(d(),e.observe(t[0],{childList:!0,subtree:!0}))},d=function(){var e,t=r(".backupbuddy-admin-page #wpbody-content > #dolly"),a=r(".backupbuddy-admin-page #wpcontent > *").first().nextUntil(".backupbuddy-admin-page #wpbody"),d=r(".backupbuddy-admin-page #wpbody-content > *").first().nextUntil(".backupbuddy-admin-page #wpbody-content > .wrap:first"),n=r(".backupbuddy-admin-page #wpbody-content > .wrap > *").first(),i="h1"===n.prop("tagName").toLowerCase()?r():n.nextUntil(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first"),n=r(".backupbuddy-admin-page .backupbuddy-tabs").length?".backupbuddy-admin-page .backupbuddy-tabs":r(".backupbuddy-admin-page .backupbuddy_api_key-hide").length?".backupbuddy-admin-page .backupbuddy_api_key-hide":!!r(".backupbuddy-admin-page .bb_progress-bar").length&&".backupbuddy-admin-page .bb_progress-bar",n=n?r(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first").nextUntil(n):r(),i=a.add(d).add(i).add(n).filter(":not( .bb-topbar-title, .backupbuddy-admin-notices, script, link, .clear, #wpbody, #wpadminbar, #screen-meta, #screen-meta-links, .backupbuddy_api_key-hide, #dolly, :empty, .bub-notice-moved )"),n=i.filter(':not( [class*="backupbuddy"] )').filter(":visible"),i=i.filter('[class*="backupbuddy"]').filter(":visible");if(t.length&&t.css("padding-top","0").css("padding-right","25px").appendTo(".bb-topbar-title"),n.length||i.length){if(n.length){var o=u();if(!o.length)return void console.error("There was a problem initializing BackupBuddy Admin Notices.");n.each(function(){var e=r(this);e.addClass("bub-notice-moved"),e.html()&&!r.contains(o,e)&&o.append(e)}),r(".backupbuddy-admin-notices-toggle .count").html(o.children().length)}i.length&&((e=s()).length?i.each(function(){e.append(r(this)),r(this).addClass("bub-notice-moved")}):console.error("There was a problem initializing BackupBuddy Notices."))}},s=function(){var e=r(".backupbuddy-internal-notices");return e.length||(e=r("<div />").addClass("backupbuddy-internal-notices"),(r(".backupbuddy-tabs .tab-controls").length?r(".backupbuddy-tabs .tab-controls"):r(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first")).after(e),new MutationObserver(t).observe(e[0],{childList:!0,subtree:!0})),e},u=function(){var t=r(".backupbuddy-admin-notices"),e=r(".backupbuddy-admin-notices-toggle");return t.length||(t=r("<div />").addClass("backupbuddy-admin-notices"),(r(".backupbuddy-tabs .tab-controls").length?r(".backupbuddy-tabs .tab-controls"):r(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first")).after(t),new MutationObserver(a).observe(t[0],{childList:!0,subtree:!0})),e.length||(r("#screen-meta-links").append('<div class="backupbuddy-meta-link-wrap hide-if-no-js backupbuddy-admin-notices-toggle"><a href="#admin-notices" class="button show-settings"><span class="count"></span>'+BackupBuddy.Vars.get("strings.admin_notices")+"</a></div>"),(e=r(".backupbuddy-admin-notices-toggle")).on("click",function(e){e.preventDefault(),r(this).find("a:first").toggleClass("screen-meta-active"),t.toggleClass("open")})),t},n=function(){BackupBuddy.Vars.get("hide_quick_setup")||r("#screen-meta-links").append('<div class="backupbuddy-meta-link-wrap hide-if-no-js screen-meta-toggle"><a href="?page=pb_backupbuddy_backup&wizard=1" class="show-settings no-dropdown">'+BackupBuddy.Vars.get("strings.quick_setup")+"</a></div>")},i=function(){var e=r("<a />").attr("href","#importbuddy").addClass("show-settings").text(BackupBuddy.Vars.get("strings.importbuddy")),t=r("<div/>").addClass("backupbuddy-meta-link-wrap hide-if-no-js screen-meta-toggle"),a=r("<div />").addClass("hover-menu"),d=r("<a />").addClass("download-importbuddy").attr("href",BackupBuddy.Vars.get("ajax.importbuddy")).text(BackupBuddy.Vars.get("strings.importbuddy_download")),n=r("<a />").addClass("send-importbuddy").attr("href",BackupBuddy.Vars.get("ajax.destination_picker")).text(BackupBuddy.Vars.get("strings.importbuddy_send")).attr("rel","importbuddy.php");e.on("click",function(e){e.preventDefault()}),d.on("click",function(e){e.preventDefault();var a=r(this).attr("href");return BackupBuddy.Vars.get("importbuddy_pass_set")?BackupBuddy.Modal.open({mode:"prompt",title:"ImportBuddy Password",content:BackupBuddy.Vars.get("strings.importbuddy_prompt_haspass"),prompt:function(e){var t=a;null!=e&&""!=e&&(t+="&p="+encodeURIComponent(e)),window.location.href=t}}):BackupBuddy.Modal.open({mode:"prompt",title:"ImportBuddy Password",content:BackupBuddy.Vars.get("strings.importbuddy_prompt_nopass"),prompt:function(e){null==e||""==e?""==e&&BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.importbuddy_no_password")}):window.location.href=a+"&p="+encodeURIComponent(e)}}),!1}),n.on("click",function(e){if(e.preventDefault(),!BackupBuddy.Vars.get("importbuddy_pass_set"))return BackupBuddy.Modal.open({mode:"alert",content:"You must set an ImportBuddy password via the BackupBuddy settings page before you can send this file."}),!1;var t=r(this).attr("href"),e=r(this).attr("rel");return e&&("importbuddy.php"!==e&&(t+="&action_verb=to%20send%20to"),t+="&callback_data="+e),t+="&sending=1&TB_iframe=1&width=640&height=455",tb_show("BackupBuddy",t,null),!1}),a.append(d).append(n),e.append(a),t.append(e),r("#screen-meta-links").append(t)};return{init:function(){r("body").hasClass("toplevel_page_pb_backupbuddy_backup")&&(n(),i()),e()},init_observers:e}}(jQuery),jQuery(window).on("load",BackupBuddy.Core.init);BackupBuddy=window.BackupBuddy||{},MutationObserver=window.MutationObserver||window.WebKitMutationObserver;BackupBuddy.Destinations=function(n){"use strict";var a=0,d=0,e=function(){t(),i()},t=function(){var e=new MutationObserver(o),t=n("#pb_backupbuddy_iframe-dest-wrap").first(),a=n("body.destination-tabs"),d=n(".bb-iframe-divpadding-noscroll");(t.length||a.length||d.length)&&(t=(t.length?t:a.length?a:d)[0],a={childList:!0,subtree:!0},d.length&&(a.attributes=!0),o(),e.observe(t,a))},i=function(){var e=new MutationObserver(r),t=n(".tab-contents.active iframe.backupbuddy-destination-iframe").first(),a=n("body.backupbuddy-admin-iframe");(t.length||a.length)&&(a=(t.length?t:a)[0],r(),e.observe(a,{childList:!0,subtree:!0}))},o=function(){var e,t=!1;(t=n("#pb_backupbuddy_iframe-dest-wrap").length?n("#pb_backupbuddy_iframe-dest-wrap")[0]:window.parent.document.getElementById("pb_backupbuddy_iframe-dest-wrap"))&&(t.removeAttribute("style"),e=t.contentWindow.document.documentElement.scrollHeight,n(".bb-iframe-divpadding-noscroll").length&&(e+=50),t.style.height=e+"px",a!==e&&(a=e))},r=function(){var e,t=!1;(t=n(".tab-contents.active iframe.backupbuddy-destination-iframe").length?n(".tab-contents.active iframe.backupbuddy-destination-iframe").first()[0]:window.parent.document.getElementById("pb_backupbuddy_iframe-dest-wrap"))&&(t.removeAttribute("style"),e=t.contentWindow.document.documentElement.scrollHeight,e+=50,t.style.height=e+"px",d!==e&&(d=e))};return{init:function(){e(),n(window).on("backupbuddy.tabs.switch",function(){o(),r()})},tabsIframeLoad:function(){n(".backupbuddy_destinations_iframe_load").fadeOut("fast"),o()},resizeDestIframe:r}}(jQuery),jQuery(window).on("load",BackupBuddy.Destinations.init),(BackupBuddy=window.BackupBuddy||{}).Diagnostics=function(n){"use strict";var a="backupbuddy_page_pb_backupbuddy_diagnostics",e=function(){n('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#extraneous-log"]').off("click").on("click",function(e){e.preventDefault(),n("#backupbuddy-extra-log").slideToggle("fast"),n("#backupbuddy_logFile").attr("data-loaded")||d()}),n('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#remoteapi-log"]').off("click").on("click",function(e){e.preventDefault(),n("#backupbuddy-remoteapi-log").slideToggle("fast"),n("#backupbuddy_remoteapi_logFile").attr("data-loaded")||i()}),n('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#hide"]').off("click").on("click",function(e){e.preventDefault();e=n(this).data("log");"main"===e?n("#backupbuddy-extra-log").slideToggle("fast"):"remote"===e&&n("#backupbuddy-remoteapi-log").slideToggle("fast")})},t=function(){n(document).on("backupbuddy.tabs.switch",function(e,t){n("body").hasClass(a)})},d=function(e){e=void 0===e?0:e,n("#backupbuddy_logFile").length&&n.post(BackupBuddy.Vars.get("ajax.getMainLog"),{confirmed:e},function(e){"string"!=typeof e?confirm("WARNING: Log file is very large ("+e.size+"). This could take a while to load. Are you sure you want to continue?")?d(1):n("#backupbuddy-extra-log").slideToggle("fast"):n("#backupbuddy_logFile").text(e).attr("data-loaded","true")})},i=function(e){e=void 0===e?0:e,n("#backupbuddy_remoteapi_logFile").length&&n.post(BackupBuddy.Vars.get("ajax.getRemoteApiLog"),{confirmed:e},function(e){"string"!=typeof e?confirm("WARNING: Log file is very large ("+e.size+"). This could take a while to load. Are you sure you want to continue?")?i(1):n("#backupbuddy-remoteapi-log").slideToggle("fast"):n("#backupbuddy_remoteapi_logFile").text(e).attr("data-loaded","true")})},o=function(){n('a[href="#reset-log"]').off("click").on("click",function(e){if(e.preventDefault(),!confirm("Are you sure you want to reset this log?"))return!1;var t,a,d=n(this).data("log");e=d,t=function(){n('textarea[data-log-file="'+d+'"]').text("-- Log Reset --"),"main"===d?n("#backupbuddy_logFile").removeAttr("data-loaded"):"remote"===d&&n("#backupbuddy_remoteapi_logFile").removeAttr("data-loaded")},n.post(BackupBuddy.Vars.get("ajax.reset_log"),{log:e},function(e){e.success&&t?t():(e.error&&BackupBuddy.Modal.open({mode:"alert",content:e.error}),a&&a())})})};return{init:function(){e(),t(),o()},load_logs:function(){d(),i()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Diagnostics.init),(BackupBuddy=window.BackupBuddy||{}).File_Viewer=function(r){"use strict";var e=function(){r(document).on("backupbuddy.modal.close",function(){r(".backupbuddy-file-viewer .CodeMirror").remove(),r(".backupbuddy-file-viewer .file-contents").remove(),r(".backupbuddy-file-viewer .file-preview").remove()})},t=function(){r("a.view-file").off("click").on("click",function(e){e.preventDefault();var a,d,n,t=r(this),i=r("#backupbuddy-data-browser form").attr("data-zip"),o=t.attr("data-path"),e=t.attr("data-mode"),t=t.attr("data-type");i=i,o=o,a=e,t=t,n=r("<div />").addClass("backupbuddy-file-viewer").addClass("mode-"+a),d="code"===a?(d=r("<textarea />").addClass("file-contents loading").val("Loading...").attr("readonly","readonly"),n.append(d),n.find(".file-contents")):(d=r("<div />").addClass("file-preview loading").html("Loading..."),n.append(d),n.find(".file-preview")),BackupBuddy.Modal.open({content:n,title:o}),r.ajax({url:BackupBuddy.Vars.get("ajax.get_file"),data:{backup:i,path:o,mode:a,type:t},success:function(e){var t;void 0!==e.warning&&(r("<div />").addClass("warning").html(e.warning),console.log(e.warning)),e.success?(d.removeClass("loading"),"code"===a?(d.val(e.contents),BackupBuddy.Modal.set_size("max"),(t=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{}).codemirror=_.extend({},t.codemirror,{indentUnit:1,tabSize:4,mode:e.mode,indentWithTabs:!0,readOnly:!0}),wp.codeEditor.initialize(d,t)):BackupBuddy.Modal.content(e.contents)):void 0!==e.error&&(r("<div />").addClass("error").html(e.error),console.log(e.error),n.hide())}})})};return{init:function(){t(),e()}}}(jQuery),jQuery(window).on("load",BackupBuddy.File_Viewer.init),(BackupBuddy=window.BackupBuddy||{}).FileTree=function(u){"use strict";function c(e){var t=u("<span/>").addClass("spinner");e.append(t)}function l(e){return e.find(".spinner").length}function p(e){e.find(".spinner").remove()}function b(e){var t=e.attr("href").replace("#","");e.toggleClass("open"),e.hasClass("open")?u('tr[data-parent-id="'+t+'"].hidden').removeClass("hidden"):(u('tr[data-parent-id^="'+t+'"]:not(.hidden)').addClass("hidden"),u('tr[data-parent-id^="'+t+'"] a.folder-toggle.open').removeClass("open"))}function f(e,t){e.toggleClass("open"),t.toggleClass("expanded"),t.find("ul:first").toggleClass("open")}function k(e,t){t=void 0===t?250:t,setTimeout(function(){u(".backupbuddy-file-tree").css("height",e.outerHeight(!0))},t)}var y=function(e){return u('.panel[data-path="'+e+'"]').length},g=function(e,t){var a=u('.panel[data-path="'+e+'"]'),d=u(".panel.active");t=void 0===t?"forward":"back",a.length&&d.length&&(a.addClass("instant"),"forward"===t?setTimeout(function(){a.removeClass("inactive").addClass("next"),setTimeout(function(){a.removeClass("instant"),setTimeout(function(){d.addClass("inactive").removeClass("active"),a.addClass("active").removeClass("next")},5)},5)},5):setTimeout(function(){a.removeClass("next").addClass("inactive"),setTimeout(function(){a.removeClass("instant"),setTimeout(function(){d.addClass("next").removeClass("active"),a.addClass("active").removeClass("inactive")},5)},5)},5),k(a,265))},h=function(e,n,i){var t=u("#backupbuddy-file-tree"),a=u("#backupbuddy-data-browser > form"),d=!!a.attr("data-zip")&&a.attr("data-zip"),o=!!a.attr("data-serial")&&a.attr("data-serial"),r=u('input[name="backupbuddy_restore_destination"]').val(),a=t.hasClass("panels"),s=void 0===n?"inside":"after";d&&o&&(e=void 0===e?"__root__":e,n=void 0===n?t:n,a&&(s="append",n=t),u.ajax({url:BackupBuddy.Vars.get("ajax.file_tree"),data:{dat_viewer:d,path:e,serial:o,destination:r},success:function(e){var t,a,d;"inside"===s?n.html(e):"after"===s?n.after(e):"append"===s&&(t=".panel.incoming",a=240,n.hasClass("loading")&&(n.html(""),t=".panel",a=10),n.find(".panel.active").addClass("inactive").removeClass("active"),n.append(e),d=n.find(t),setTimeout(function(){d.addClass("active").removeClass("incoming")},5),k(d,a)),n.removeClass("loading"),u('.backupbuddy-file-tree a.folder-toggle:not([data-bound="true"])').each(function(){var d=u(this),n=u(".backupbuddy-file-tree table").length?"table":"list";d.attr("data-bound","true"),d.on("click",function(e){var t,a;e.preventDefault(),d.hasClass("disabled")||(e=d.attr("href").replace("#",""),y(e)?g(e):"list"==n?(t=d.parents("li:first"),a=d.parent("div"),l(a)||(t.find("ul:first").length?f(d,t):(c(a),h(t.attr("data-dir"),a,function(){f(d,t),p(a)})))):l(d)||(u('tr[data-parent-id="'+e+'"]').length?b(d):(e=d.parents("tr:first"),c(d),h(e.attr("data-dir"),e,function(){b(d),p(d)}))))})}),u('.backupbuddy-file-tree a.breadcrumb:not([data-bound="true"])').each(function(){var t=u(this);t.attr("data-bound","true"),t.on("click",function(e){e.preventDefault(),t.hasClass("disabled")||(e=t.attr("href").replace("#",""),y(e)&&g(e,"back"))})}),1===u("ul#tree_root > li").length?u("ul#tree_root > li > a.folder-toggle").trigger("click"):1===u("table#tree_root tbody tr").length&&u("table#tree_root tbody tr a.folder-toggle").trigger("click"),u('.backupbuddy-file-tree input[type="checkbox"]:not([data-toggler-bound="true"])').each(function(){var a=u(this),d=u(".backupbuddy-file-tree > table").length?"table":"list";a.attr("data-toggler-bound","true"),a.on("change",function(){var e,t;"list"==d?(a.parents("li:first").find('ul:first input[type="checkbox"]'),a.parents("li:first").parent("ul").parent("li").find('input[type="checkbox"]:first')):((e=(t=a.parents("tr:first")).attr("id")?t.attr("id").replace("dir_",""):"")&&u('tr[data-parent-id^="'+e+'"] input[type="checkbox"]'),t=t.attr("data-parent-id"),u("#dir_"+t).find('input[type="checkbox"]:first'))})}),setTimeout(BackupBuddy.FileTree.sticky_headers,500),BackupBuddy.Restore.init(),BackupBuddy.File_Viewer.init(),"function"==typeof i&&i()}}))},e=function(){var e=u("#backupbuddy-data-browser > form"),e=e.attr("data-zip")?e.attr("data-zip"):BackupBuddy.Vars.get("backup_zip");e&&u.ajax({url:BackupBuddy.Vars.get("ajax.backup_info"),data:{backup:e,serial:BackupBuddy.Vars.get("backup_serial")},success:function(e){var t=u(".backup-size"),a=u(".backup-wp-version");e.success&&(void 0!==e.info.size&&t.hide().html(e.info.size).fadeIn("fast"),void 0!==e.info.wp_version&&a.hide().html(BackupBuddy.Vars.get("strings.wp_version")+" "+e.info.wp_version).fadeIn("fast"))}})};return{init:function(){h(),e()},sticky_headers:function(){var t,a,d,n=!1,i=!1,e=u("#backupbuddy-file-tree.panels").length,o=e?"#backupbuddy-file-tree .panel.active table":"#backupbuddy-file-tree table";u(o).length?(e&&u("#backupbuddy-file-tree table").stickyTableHeaders("destroy"),u(o).stickyTableHeaders({fixedOffset:u("#wpadminbar")}),t=u(".tableFloatingHeaderOriginal")):(n=(t=u(o=e?".panel.active .list-header":".list-header")).width(),i=t.outerHeight()),t.length&&(t.attr("data-is-sticky")||(t.attr("data-is-sticky",!0),a=t.offset().top-u("#wpadminbar").outerHeight(),d=u("#backupbuddy-data-browser"),u(window).on("scroll",function(){var e=u(window).scrollTop();a<e&&d.height()+d.offset().top-t.height()>e?(t.addClass("stuck"),n&&t.css("width",n),i&&d.css("padding-top",i)):(t.removeClass("stuck").removeAttr("style"),d.removeAttr("style"),n=n&&t.width(),i=i&&t.outerHeight())})))}}}(jQuery),jQuery(window).on("load",BackupBuddy.FileTree.init),function(d){"use strict";d.fn.serializeObject=function(){var e=this.serializeArray(),t={},a=[];return d.each(e,function(){var e=null!=this.value?this.value:"";0<=this.name.indexOf("[]")&&(this.name=this.name.replace("[]",""),a.push(this.name)),null!=t[this.name]&&a.includes(this.name)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(e)):t[this.name]=e}),t}}(jQuery);var pb_backupbuddy_profile_updated,backupbuddy_is_dir=function(e){return"/"===e.substr(e.length-1)},backupbuddy_trim_slashes=function(e){return e.replace(/^\/+|\/+$/g,"")},backupbuddy_basename=function(e,t){t=void 0!==t&&t;e=new String(e);return e=(e=backupbuddy_trim_slashes(e)).substring(e.lastIndexOf("/")+1),t&&-1!=e.lastIndexOf(".")&&(e=e.substring(0,e.lastIndexOf("."))),e},backupbuddy_autoscroll=function(e){e.scrollTop(e[0].scrollHeight)},backupbuddy_oauth_window=function(e,t,a,d){var n=null!=window.screenLeft?window.screenLeft:window.screenX,i=null!=window.screenTop?window.screenTop:window.screenY,o=window.innerWidth||document.documentElement.clientWidth||screen.width,r=window.innerHeight||document.documentElement.clientHeight||screen.height,s=o/window.screen.availWidth,n=(o-a)/2/s+n,i=(r-d)/2/s+i,n=window.open(e,t,"scrollbars=no, width="+a/s+", height="+d/s+", top="+i+", left="+n);return window.focus&&n.focus(),n};(BackupBuddy=window.BackupBuddy||{}).Modal=function(l){"use strict";var p=!1,b={},t={content:"",theme:"",mode:"",title:"",size:{},strings:{alert_button:"OK",confirm_affirmative:"OK",confirm_negative:"Cancel",prompt_button:"OK"},callbacks:{primary:function(){return k(),!0},secondary:function(){return k(),!1}},prompt:function(){return!1},prompt_default:!1,close_on_background_click:!0,close_with_esc_key:!0,disable_close_button:!1,focus_primary_button:!1},a=function(){l("body").addClass("backupbuddy-modal-open"),p.fadeIn("fast",function(){l(document).trigger("backupbuddy.modal.show")})},d=function(e){b=l.extend(!0,{},t,e),i(e),n()},n=function(){!1!==p||(p=l(".backupbuddy-modal")).length?(e(),s()):p=r(),b.theme&&p.addClass("theme-"+b.theme),b.mode&&p.addClass("mode-"+b.mode),b.title?u(b.title):p.addClass("no-title"),b.content&&o(b.content),b.size&&c(b.size)},e=function(){p.html(""),p.removeClass("no-title"),p.removeClass(function(e,t){t=(t.match(/(^|\s)theme-\S+/g)||[]).join(" ");return t=((t=(t.match(/(^|\s)mode-\S+/g)||[]).join(" ")).match(/(^|\s)size-\S+/g)||[]).join(" ")}),l(document).trigger("backupbuddy.modal.reset")},i=function(e){b.mode&&(void 0!==e.size&&void 0!==e.size.width||(b.size.width=500),"alert"===b.mode&&(void 0===e.close_on_background_click&&(b.close_on_background_click=!1),void 0===e.disable_close_button&&(b.disable_close_button=!0),void 0===e.focus_primary_button&&(b.focus_primary_button=!0)))},o=function(e){e instanceof jQuery||l.isArray(e)?p.find(".backupbuddy-modal-content").html("").append(e):p.find(".backupbuddy-modal-content").html(e)},r=function(){return p=l("<div />").addClass("backupbuddy-modal").hide(),l("#wpwrap").prepend(p),s(),l(document).trigger("backupbuddy.modal.create"),l(".backupbuddy-modal")},s=function(){var e,t,a,d,n,i,o=l("<div />").addClass("backupbuddy-modal-background"),r=l("<div />").addClass("backupbuddy-modal-inner"),s=l("<div />").addClass("backupbuddy-modal-content"),u=l("<h4 />").addClass("backupbuddy-modal-title"),c=l("<a />").addClass("backupbuddy-modal-close").attr("href","#close").html("&times;");"alert"!==b.mode&&"confirm"!==b.mode&&"prompt"!==b.mode||(e=l("<div />").addClass("backupbuddy-modal-dialog"),t=l("<div />").addClass("backupbuddy-modal-dialog-body"),a=l("<div />").addClass("backupbuddy-modal-dialog-actions"),(d=l("<button />").addClass("button-primary")).on("click",function(e){return e.preventDefault(),"function"==typeof b.prompt&&b.prompt(l(".backupbuddy-modal-prompt-input").val()),f(b.callbacks.primary)}),"alert"===b.mode?i=d.html(b.strings.alert_button):"confirm"===b.mode?((n=l("<button />").addClass("button-secondary").html(b.strings.confirm_negative)).on("click",function(e){return e.preventDefault(),f(b.callbacks.secondary)}),i=[n,d.html(b.strings.confirm_affirmative)]):"prompt"===b.mode&&(i=d.html(b.strings.prompt_button)),a.append(i),t.append(s),"prompt"===b.mode&&((i=l("<input/>").addClass("backupbuddy-modal-prompt-input").attr("type","text")).on("keyup",function(e){"Enter"===e.key&&d.trigger("click")}),"string"==typeof b.prompt_default&&b.prompt_default&&i.val(b.prompt_default),t.append(i)),e.append(t).append(a),s=e),c.on("click",function(e){e.preventDefault(),k()}),o.on("click",function(){b.close_on_background_click&&h()}),b.disable_close_button||r.append(c),r.append(u).append(s),p.append(o).append(r),l(document).trigger("backupbuddy.modal.build")},u=function(e){p.find(".backupbuddy-modal-title").html(e)},c=function(e){e&&"string"==typeof e?p.addClass("size-"+e):"object"==typeof e&&(void 0===e.width&&void 0===e.height||(void 0!==e.width&&p.find(".backupbuddy-modal-inner").css("width",e.width),void 0!==e.height&&p.find(".backupbuddy-modal-inner").css("height",e.height)))},f=function(e,t){"function"==typeof e&&e(t)},k=function(e){l("body").removeClass("backupbuddy-modal-open"),p&&p.length&&_()?p.fadeOut("fast",function(){f(e),l(document).trigger("backupbuddy.modal.close")}):(f(e),l(document).trigger("backupbuddy.modal.close"))},y=function(){k(function(){g(),l(document).trigger("backupbuddy.modal.destroy")})},g=function(){!1!==p&&(p.length&&(p.remove(),p=!1),l(document).trigger("backupbuddy.modal.remove"))},h=function(){"confirm"===b.mode?b.callbacks.secondary():k()},m=function(){b.close_with_esc_key&&l(document).keyup(function(e){"Escape"===e.key&&h()})},_=function(){return!1!==p&&p.is(":visible")};return{init:function(){m()},open:function(e){_()||y(),d(e),l(document).trigger("backupbuddy.modal.open"),_()||a(),"prompt"===b.mode?l(".backupbuddy-modal-prompt-input").focus():b.focus_primary_button&&l(".backupbuddy-modal-dialog-actions .button-primary").focus()},close:k,content:o,destroy:y,set_size:c,find:function(e){return p.find(e)}}}(jQuery),jQuery(window).on("load",BackupBuddy.Modal.init),(BackupBuddy=window.BackupBuddy||{}).New_Backup=function(a){"use strict";pb_backupbuddy_profile_updated=function(e,t){a("#profile_title_"+e).text(t)};var e=function(){a(".profile_item_select").on("click",function(e){e.preventDefault();e=a(this).attr("href");return e+="&after_destination="+a("#pb_backupbuddy_backup_remotedestination").val(),e+="&delete_after="+a("#pb_backupbuddy_backup_deleteafter").val(),window.location.href=e,!1})},t=function(){a("#pb_backupbuddy_afterbackupremote_box").on("change",function(){a(this).is(":checked")?tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data=delayed_send&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null):(a("#pb_backupbuddy_backup_remotedestination").val(""),a("#pb_backupbuddy_backup_deleteafter").val(""),a("#pb_backupbuddy_backup_remotetitle").html(""))})},d=function(){a("body").on("thickbox:removed",function(){""===a("#pb_backupbuddy_backup_remotedestination").val()&&a("#pb_backupbuddy_afterbackupremote_box").removeAttr("checked")})},n=function(){a(".profile_settings").click(function(e){return tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.profile_settings")+"&profile="+a(this).attr("rel")+"&callback_data="+a(this).attr("rel")+"&TB_iframe=1&width=640&height=455",null),!1})},i=function(){a("#pb_backupbuddy_profileadd_plusbutton").on("click",function(e){return e.preventDefault(),a(this).hide(),a("#pb_backupbuddy_profileadd").show(),!1})};return{init:function(){e(),t(),d(),n(),i()}}}(jQuery),jQuery(window).on("load",BackupBuddy.New_Backup.init),(BackupBuddy=window.BackupBuddy||{}).Restore=function(r){"use strict";var e=!1,n=0,i=!1,t=0,a=function(){r('.backupbuddy-file-tree input[type="checkbox"]:not([data-restore-bound="true"])').each(function(){var t=r(this);t.attr("data-restore-bound","true"),t.on("change",function(){var e=t.val();(t.is(":checked")?d:l)(e)})})},d=function(e){var t,a,d;r('#backupbuddy-restore-ui li[data-path="'+e+'"]').length||(t=o(e),d=backupbuddy_basename(e),a=backupbuddy_is_dir(e),d=r("<em/>").html(d),d=r("<li/>").attr("data-path",e).append(d),(e=r("<a />").addClass("remove-file").attr("href","#"+e).html("&#10005;")).on("click",function(e){e.preventDefault();e=r(this).attr("href").replace("#","");r('input[value="'+e+'"]').trigger("click")}),d.append(e),a&&d.addClass("folder"),a||"backupbuddy-restore-ui"!==t.attr("id")?t.find("li.folder:last").length?t.find("li.folder:last").after(d):t.append(d):t.find("li.dir").length?t.find("li.dir").before(d):t.append(d),r(".backupbuddy-restore-list .instructions").hide(),r(".backupbuddy-restore-list .button").show(),u(),backupbuddy_autoscroll(r("#backupbuddy-restore-ui")))},o=function(e){backupbuddy_is_dir(e);var e=backupbuddy_trim_slashes(e),t=s(e),e=r('ul[data-folder="'+t+'"]');return e.length||(e=c(t)),e},s=function(e){return backupbuddy_trim_slashes(e.replace(backupbuddy_basename(e),""))},u=function(){var e=g(),t="Restore";e&&(t+=" "+e),r(".button-restore").val(t)},c=function(e){var t=r("#backupbuddy-restore-ui"),a=r("<li />").attr("data-path",e).addClass("dir").html("<span>"+e+"</span>"),d=r("<ul />").attr("data-folder",e);return e?(a.append(d),t.append(a),d):t},l=function(e){var t=r('#backupbuddy-restore-ui li[data-path="'+e+'"]'),e=t.parent("ul");t.remove(),e.find("li").length||(e.parent("li").remove(),"backupbuddy-restore-ui"!==e.attr("id")&&e.remove()),r("#backupbuddy-restore-ui li").length||(r(".backupbuddy-restore-list .instructions").show(),r(".backupbuddy-restore-list .button").hide()),u()},p=function(){var t,a,d;e||(e=!0,r(".backupbuddy-restore-list").length&&(t=r(".backupbuddy-restore-list"),a=t.offset().top-r("#wpadminbar").outerHeight(),d=r("#backupbuddy-data-browser"),r(window).on("scroll",function(){var e=r(window).scrollTop();a<e&&d.height()+d.offset().top-t.height()>e?t.addClass("stuck"):t.removeClass("stuck")})))},b=function(){r("#backupbuddy-restore-status .abort-link").on("click",function(e){return e.preventDefault(),!i&&(n=1,void r(".restore-current-step").html(BackupBuddy.Vars.get("strings.aborting_restore")))}),r('a[href="#abort-restore"]').on("click",function(e){e.preventDefault();e=r(this).attr("data-restore-id");r('input[name="abort-'+e+'"]').val("1"),r('.restore-in-progress[data-restore-id="'+e+'"]').html(BackupBuddy.Vars.get("strings.aborting_restore"))})},f=function(){var e;r("#backupbuddy-restore-status").hasClass("in-progress")&&(e=!!r("#backupbuddy-restore-status").attr("data-restore-id")&&r("#backupbuddy-restore-status").attr("data-restore-id"),k(e))},k=function(d){return void 0===d&&(d=r("#backupbuddy-restore-status").attr("data-restore-id")),d?BackupBuddy.Restore.is_polling?(setTimeout(function(){k(d)},1e3),!1):(BackupBuddy.Restore.is_polling=!0,r(".tab.restore-backup").addClass("processing"),void r.ajax({url:BackupBuddy.Vars.get("ajax.restore_status"),data:{restore_id:d,abort:n},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t,a;BackupBuddy.Restore.is_polling=!1,void 0!==e.success?e.overlapping?setTimeout(function(){k(d)},5e3):e.success?(function(e){n&&(e.text=BackupBuddy.Vars.get("strings.aborting_restore")),r(".restore-current-step").html(e.text),e.locked&&(i=!0,r("#backupbuddy-restore-status .abort-link").fadeOut("fast"));var t=r(".progress-dots"),a=!1;if(e.dot&&t.find("."+e.dot).length){if(t=t.find("li"),"failed"===e.end_status)return t.find("li.loading").removeClass("loading"),t.find("li.active:last").removeClass("active").addClass("failed");t.each(function(){return!0===a?(r(this).addClass("loading"),!1):(r(this).addClass("active").removeClass("loading"),void(r(this).hasClass(e.dot)&&(a=!0)))})}}(e.status),e.is_done?(t=e.status,a=r(".restore-done"),r(".restore-status-container").css("height",r(".restore-status-container").outerHeight()),"failed"===t.end_status?(a.find(".status-complete").hide(),a.find(".status-failed").show()):"aborted"===t.end_status&&(a.find(".status-complete").hide(),a.find(".status-aborted").show()),t.error&&(a.find("p.error").length?a.find("p.error").html(t.error):(t=r("<p/>").addClass("error").html(t.error),a.find("h2.status-failed").after(t))),r(".tab.restore-backup").removeClass("processing"),r(".restore-active").fadeOut("fast",function(){a.fadeIn("fast",function(){r(".restore-status-container").removeAttr("style")})})):setTimeout(function(){k(d)},3e3)):void 0===e.error?d?y(d):console.log("Restore ID is missing."):console.log("Restore Poll Error: "+e.error):y(d)},statusCode:{404:function(){y(d)},500:function(){y(d)}},error:function(e,t,a){console.log(a),y(d)}}).fail(function(e,t,a){console.log(a),y(d)})):(console.log("Missing restore ID."),!1)},y=function(e){BackupBuddy.Restore.is_polling=!1,++t<5?setTimeout(function(){k(e)},5e3):location.reload()},g=function(e){var t=(e=void 0===e?r("#backupbuddy-data-browser form").serializeObject():e).backupbuddy_restore,a=0,d=0;if(!t)return!1;r.isArray(t)||(t=new Array(t));for(var n=0;n<t.length;n++)backupbuddy_is_dir(t[n])?d++:a++;if(!a&&!d)return!1;e="";return d&&(e=d+" "+(1===d?BackupBuddy.Vars.get("strings.folder"):BackupBuddy.Vars.get("strings.folders"))),a&&(e&&(e+=" & "),e+=a+" "+(1===a?BackupBuddy.Vars.get("strings.file"):BackupBuddy.Vars.get("strings.files"))),e},h=function(){r('a[href^="#restore-details-"]').off("click").on("click",function(e){e.preventDefault(),r(r(this).attr("href")).toggleClass("open")})},m=function(){r('#backupbuddy-data-browser form:not([data-bound="true"])').each(function(){var a=r(this);a.attr("data-bound","true"),a.on("submit",function(e){e.preventDefault();var t=r(this).serializeObject();if(!g(t))return!1;v("partial",function(){t.backupbuddy_zip=a.attr("data-zip"),t.backupbuddy_restore_type="files",t.backupbuddy_restore_tables="",r.ajax({url:BackupBuddy.Vars.get("ajax.restore"),data:t,type:"post",success:function(e){e.success?(k(e.restore_id),r(".tab.restore-backup").addClass("processing"),r(".backupbuddy-restore-header").slideUp("fast"),r("#backupbuddy-data-browser").slideUp("fast",function(){r("#backupbuddy-data-browser").addClass("hidden"),r("#backupbuddy-restore-status").addClass("open")})):(e=r("<p/>").addClass("error").html(e.error),BackupBuddy.Modal.open({mode:"alert",content:e}))}}),BackupBuddy.Modal.close()})})})},_=function(){r("a.restore-full-backup").off("click").on("click",function(e){e.preventDefault();var t=r(this),d=t.attr("data-what"),n=t.attr("href"),i=t.attr("data-zip"),o=t.attr("data-destination-id"),e=function(){var e=d||BackupBuddy.Modal.find('input[name="full-restore-type"]:checked').val();if(!e){var t=BackupBuddy.Modal.find("ul.full-restore-options"),a=BackupBuddy.Modal.find(".error");return a.length||(a=r("<p />").addClass("error"),t.before(a)),a.html(BackupBuddy.Vars.get("strings.select_restore_type_error")).show(),!1}a="full";"db"===e?a+="_db":"files"===e&&(a+="_files"),v(a,function(){BackupBuddy.Modal.open({title:"Restoring from Backup",content:r("<p/>").css("text-align","center").html(BackupBuddy.Vars.get("strings.starting_restore"))}),r.ajax({url:BackupBuddy.Vars.get("ajax.restore"),data:{backupbuddy_zip:i,backupbuddy_restore:"*",backupbuddy_restore_tables:"*",backupbuddy_restore_destination:o,backupbuddy_restore_type:e},type:"post",success:function(e){e.success?(n=x("restore="+encodeURI(e.restore_id),n),window.location.replace(n)):e.error&&BackupBuddy.Modal.content(r("<p/>").addClass("error").css("text-align","center").html(e.error))}})})};d?e():((t=r("#backupbuddy-select-restore-type").clone()).addClass(t.attr("id")).removeAttr("id").removeAttr("style"),t.find('input[type="radio"]:first').attr("checked","checked"),BackupBuddy.Modal.open({title:BackupBuddy.Vars.get("strings.select_restore_title"),content:t,mode:"confirm",strings:{confirm_affirmative:BackupBuddy.Vars.get("strings.continue")},callbacks:{primary:e}}))})},v=function(e,t){var a="backupbuddy-confirm-"+(e=void 0===e?"partial":e)+"-restore",d="backupbuddy-"+e+"-restore-confirm",n=r("<input />").attr("type","checkbox").attr("value","1").attr("id",a),n=[r("<div />").attr("id",d).html(BackupBuddy.Vars.get("strings.confirm_"+e+"_restore")),r("<label/>").html(BackupBuddy.Vars.get("strings.confirm_"+e+"_restore_cbx")).prepend(n)];BackupBuddy.Modal.open({title:BackupBuddy.Vars.get("strings.confirm_restore_title"),content:n,mode:"confirm",strings:{confirm_affirmative:BackupBuddy.Vars.get("strings.confirm_restore_affirmative")},callbacks:{primary:function(){if(r("#"+a).is(":checked"))return t(),!0;var e=r("#"+d).find(".error");return e.length||(e=r("<p />").addClass("error"),r("#"+d).append(e)),e.html(BackupBuddy.Vars.get("strings.confirm_restore_error")).show(),!1}}})},B=function(){r(".restore-in-progress").each(function(){var e=r(this).attr("data-restore-id");w(e)})},w=function(d){if(BackupBuddy.Restore.is_polling)return setTimeout(function(){w(d)},1e3),!1;var a=r('input[name="abort-'+d+'"]').val();BackupBuddy.Restore.is_polling=!0,r.ajax({url:BackupBuddy.Vars.get("ajax.restore_status"),data:{restore_id:d,abort:a},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t;BackupBuddy.Restore.is_polling=!1,void 0!==e.success?e.overlapping?setTimeout(function(){w(d)},5e3):e.success?(t=r('.restore-in-progress[data-restore-id="'+d+'"]'),"1"===a?t.html(BackupBuddy.Vars.get("strings.aborting_restore")):t.html(e.status.text),e.locked&&r('a[href="#abort-restore"][data-restore-id="'+d+'"]').fadeOut("fast"),e.is_done?((t=t.parents("td:first")).html(e.status.text),t.next("td").html(e.status.html),r("tr#restore-details-"+d).find("td:first").html(e.status.details),h()):setTimeout(function(){w(d)},3e3)):void 0===e.error?d?C(d):console.log("Restore ID is missing."):console.log("Restore Poll Error: "+e.error):w(d)},statusCode:{404:function(){C(d)},500:function(){C(d)}},error:function(e,t,a){console.log(a),C(d)}}).fail(function(e,t,a){console.log(a),C(d)})},C=function(e){BackupBuddy.Restore.is_polling=!1,++t<5?setTimeout(function(){w(e)},5e3):location.reload()},x=function(e,t){var a="",d=t;return 0<=t.indexOf("#")&&(d=t.split("#")[0],a="#"+t.split("#")[1]),0<=d.indexOf("?")?d+="&"+e:d+="?"+e,d+a},j=function(){r(".toggle-restore-archive").on("click",function(e){e.preventDefault(),r(".backupbuddy-restore-archive").toggleClass("hidden");e="show"===r(this).text().toLowerCase()?"Hide":"Show";r(this).text(e)})},H=function(){r(".delete-restore").on("click",function(e){e.preventDefault();var t=r(this).attr("rel"),a="true"===r(this).attr("data-corrupt")?"1":"0",d=r(this).parents("tr"),n=d.next("tr:first");BackupBuddy.Modal.open({mode:"confirm",title:"Delete Restore",content:"Are you sure you want to delete this restore? This cannot be undone!",callbacks:{primary:function(){r.ajax({url:BackupBuddy.Vars.get("ajax.restore_delete"),data:{id:t,corrupt:a},dataType:"json",success:function(e){e.success?(d.remove(),n.remove(),r(".backupbuddy-restore-archive tbody tr").length||(r(".backupbuddy-restore-archive").prev("h4").remove(),r(".backupbuddy-restore-archive").remove()),BackupBuddy.Modal.close()):BackupBuddy.Modal.open({mode:"alert",title:"Restore Delete Error",content:"There was a problem deleting the restore: "+e.error})}})}}})})};return{init:function(){_(),a(),p(),m(),h(),b(),f(),B(),j(),H()},is_polling:!1,bind_restore_buttons:_}}(jQuery),jQuery(window).on("load",BackupBuddy.Restore.init);var checkEmailNotifyErrorStatus,BackupBuddy=window.BackupBuddy||{},pb_settings_changed=!1;BackupBuddy.Settings=function(a){"use strict";var d="backupbuddy_page_pb_backupbuddy_settings",e="."+d+" ",t=function(){a("#pb_backupbuddy_email_notify_error").length&&(""===a("#pb_backupbuddy_email_notify_error").val()?(a("#pb_backupbuddy_email_notify_error").css("background-color","#FFA1A1"),a("#emailErrorNotifyHiddenAlert").show()):(a("#pb_backupbuddy_email_notify_error").css("background-color","#FFF"),a("#emailErrorNotifyHiddenAlert").hide()))},n=function(){a(".pb_backupbuddy_customize_email_scheduled_start").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_scheduled_start_row").slideToggle()}),a(".pb_backupbuddy_customize_send_finish").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_send_finish_row").slideToggle()}),a(".pb_backupbuddy_customize_email_scheduled_complete").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_scheduled_complete_row").slideToggle()}),a(".pb_backupbuddy_customize_email_error").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_error_row").slideToggle()})},i=function(){a("#pb_backupbuddy_email_error_test").on("click",function(){return a.post(BackupBuddy.Vars.get("ajax.email_error_test"),{email:a("#pb_backupbuddy_email_notify_error").val()},function(e){"1"!=(e=a.trim(e)).charAt(0)?BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.error_testing")+":\n\n"+e}):BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.email_test_sent")+"\n\n"+e.slice(1)})}),!1})},o=function(){a(document).on("backupbuddy.tabs.switch",function(e,t){a("body").hasClass(d)&&"#advanced"===t&&a(".nav-tab-2").trigger("click")})},r=function(){a("#pb_backupbuddy_email_notify_error").on("change",function(){t()})},s=function(){a(e+".backupbuddy-tabs .tab-controls a").on("click",function(e){!0===pb_settings_changed&&(BackupBuddy.Modal.open({mode:"alert",content:"You have made changes without saving! Be sure to save your changes!"}),pb_settings_changed=!1)}),a(e+".pb_form").on("change",function(){pb_settings_changed=!0})};return{init:function(){n(),i(),o(),t(),r(),s()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Settings.init),(BackupBuddy=window.BackupBuddy||{}).Tabs=function(d){"use strict";var e=function(){var e;d(".backupbuddy-tabs").length&&(d(".backupbuddy-tabs .tab-controls a").on("click",function(e){e.preventDefault();e=d(this).attr("href");"#"===e.charAt(0)?t(e):window.location.replace(e)}),(e=window.location.hash)&&t(e))},t=function(e){var t=d('.backupbuddy-tabs .tab-controls a[href$="'+e+'"]').parent("li"),a=d(e);t.length&&a.length&&(d(".backupbuddy-tabs .tab-controls .active").removeClass("active"),t.addClass("active"),d(".backupbuddy-tabs .tab-contents.active").removeClass("active"),a.addClass("active"),d(document).trigger("backupbuddy.tabs.switch",e),history.pushState?history.pushState(null,null,e):window.location.hash=e)};return{init:function(){e()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Tabs.init),(BackupBuddy=window.BackupBuddy||{}).Vars=function(){"use strict";var n=function(e){return void 0!==backupbuddy_vars.ajax_base&&backupbuddy_vars.ajax_base+e};return{get:function(e){if("undefined"==typeof backupbuddy_vars)return!1;for(var t=e,a=backupbuddy_vars,d=!1;0<=t.indexOf(".");){d=t.split(".")[0],t=e.replace(d+".","");void 0!==a[d]&&(a=a[d])}return void 0===a[t]?"ajax"===d&&n(t):a[t]},get_ajax_url:n}}(jQuery);